{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.disableWebUSB = exports.requestLogin = exports.customMessage = exports.getSettings = exports.renderWebUSBButton = exports.uiResponse = exports.call = exports.init = exports.cancel = exports.dispose = exports.manifest = exports.eventEmitter = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _events = _interopRequireDefault(require(\"events\"));\n\nvar _PopupManager = _interopRequireDefault(require(\"../../popup/PopupManager\"));\n\nvar iframe = _interopRequireWildcard(require(\"../../iframe/builder\"));\n\nvar _button = _interopRequireDefault(require(\"../../webusb/button\"));\n\nvar _message = require(\"../../message\");\n\nvar _builder2 = require(\"../../message/builder\");\n\nvar _ConnectSettings = require(\"../../data/ConnectSettings\");\n\nvar _debug = require(\"../../utils/debug\");\n\nvar _constants = require(\"../../constants\");\n\nvar $T = _interopRequireWildcard(require(\"../../types\"));\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj[\"default\"] = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar eventEmitter = new _events[\"default\"]();\nexports.eventEmitter = eventEmitter;\n\nvar _log = (0, _debug.initLog)('[trezor-connect.js]');\n\nvar _settings = (0, _ConnectSettings.parse)();\n\nvar _popupManager;\n\nvar initPopupManager = function initPopupManager() {\n  var pm = new _PopupManager[\"default\"](_settings);\n  pm.on(_constants.POPUP.CLOSED, function (error) {\n    iframe.postMessage({\n      type: _constants.POPUP.CLOSED,\n      payload: error ? {\n        error: error\n      } : null\n    }, false);\n  });\n  return pm;\n};\n\nvar manifest = function manifest(data) {\n  _settings = (0, _ConnectSettings.parse)(_objectSpread(_objectSpread({}, _settings), {}, {\n    manifest: data\n  }));\n};\n\nexports.manifest = manifest;\n\nvar dispose = function dispose() {\n  eventEmitter.removeAllListeners();\n  iframe.dispose();\n  _settings = (0, _ConnectSettings.parse)();\n\n  if (_popupManager) {\n    _popupManager.close();\n  }\n};\n\nexports.dispose = dispose;\n\nvar cancel = function cancel(error) {\n  if (_popupManager) {\n    _popupManager.emit(_constants.POPUP.CLOSED, error);\n  }\n}; // handle message received from iframe\n\n\nexports.cancel = cancel;\n\nvar handleMessage = function handleMessage(messageEvent) {\n  // ignore messages from domain other then iframe origin\n  if (messageEvent.origin !== iframe.origin) return;\n  var message = (0, _message.parseMessage)(messageEvent.data);\n  var event = message.event,\n      type = message.type,\n      payload = message.payload;\n  var id = message.id || 0;\n\n  _log.log('handleMessage', message);\n\n  switch (event) {\n    case _constants.RESPONSE_EVENT:\n      if (iframe.messagePromises[id]) {\n        // resolve message promise (send result of call method)\n        iframe.messagePromises[id].resolve({\n          id: id,\n          success: message.success,\n          payload: payload\n        });\n        delete iframe.messagePromises[id];\n      } else {\n        _log.warn(\"Unknown message id \" + id);\n      }\n\n      break;\n\n    case _constants.DEVICE_EVENT:\n      // pass DEVICE event up to html\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload); // DEVICE_EVENT also emit single events (connect/disconnect...)\n\n      break;\n\n    case _constants.TRANSPORT_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.BLOCKCHAIN_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.UI_EVENT:\n      if (type === _constants.IFRAME.BOOTSTRAP) {\n        iframe.clearTimeout();\n        break;\n      }\n\n      if (type === _constants.IFRAME.LOADED) {\n        iframe.initPromise.resolve();\n      }\n\n      if (type === _constants.IFRAME.ERROR) {\n        iframe.initPromise.reject(payload.error);\n      } // pass UI event up\n\n\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    default:\n      _log.log('Undefined message', event, messageEvent);\n\n  }\n};\n\nvar init = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(settings) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (settings === void 0) {\n              settings = {};\n            }\n\n            if (!iframe.instance) {\n              _context.next = 3;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_AlreadyInitialized');\n\n          case 3:\n            _settings = (0, _ConnectSettings.parse)(_objectSpread(_objectSpread({}, _settings), settings));\n\n            if (_settings.manifest) {\n              _context.next = 6;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_ManifestMissing');\n\n          case 6:\n            if (!_settings.lazyLoad) {\n              _context.next = 9;\n              break;\n            } // reset \"lazyLoad\" after first use\n\n\n            _settings.lazyLoad = false;\n            return _context.abrupt(\"return\");\n\n          case 9:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _log.enabled = !!_settings.debug;\n            window.addEventListener('message', handleMessage);\n            window.addEventListener('unload', dispose);\n            _context.next = 15;\n            return iframe.init(_settings);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function init(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.init = init;\n\nvar call = /*#__PURE__*/function () {\n  var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(params) {\n    var response;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(!iframe.instance && !iframe.timeout)) {\n              _context2.next = 15;\n              break;\n            } // init popup with lazy loading before iframe initialization\n\n\n            _settings = (0, _ConnectSettings.parse)(_settings);\n\n            if (_settings.manifest) {\n              _context2.next = 4;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 4:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _popupManager.request(true); // auto init with default settings\n\n\n            _context2.prev = 6;\n            _context2.next = 9;\n            return init(_settings);\n\n          case 9:\n            _context2.next = 15;\n            break;\n\n          case 11:\n            _context2.prev = 11;\n            _context2.t0 = _context2[\"catch\"](6);\n\n            if (_popupManager) {\n              // Catch fatal iframe errors (not loading)\n              if (['Init_IframeBlocked', 'Init_IframeTimeout'].includes(_context2.t0.code)) {\n                _popupManager.postMessage((0, _builder2.UiMessage)(_constants.UI.IFRAME_FAILURE));\n              } else {\n                _popupManager.close();\n              }\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t0));\n\n          case 15:\n            if (!iframe.timeout) {\n              _context2.next = 17;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 17:\n            if (!iframe.error) {\n              _context2.next = 19;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(iframe.error));\n\n          case 19:\n            // request popup window it might be used in the future\n            if (_settings.popup && _popupManager) {\n              _popupManager.request();\n            } // post message to iframe\n\n\n            _context2.prev = 20;\n            _context2.next = 23;\n            return iframe.postMessage({\n              type: _constants.IFRAME.CALL,\n              payload: params\n            });\n\n          case 23:\n            response = _context2.sent;\n\n            if (!response) {\n              _context2.next = 27;\n              break;\n            }\n\n            if (!response.success && response.payload.code !== 'Device_CallInProgress' && _popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", response);\n\n          case 27:\n            if (_popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_NoResponse')));\n\n          case 31:\n            _context2.prev = 31;\n            _context2.t1 = _context2[\"catch\"](20);\n\n            _log.error('__call error', _context2.t1);\n\n            if (_popupManager) {\n              _popupManager.close();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t1));\n\n          case 36:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[6, 11], [20, 31]]);\n  }));\n\n  return function call(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.call = call;\n\nvar customMessageResponse = function customMessageResponse(payload) {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.UI.CUSTOM_MESSAGE_RESPONSE,\n    payload: payload\n  });\n};\n\nvar uiResponse = function uiResponse(response) {\n  if (!iframe.instance) {\n    throw _constants.ERRORS.TypedError('Init_NotInitialized');\n  }\n\n  var type = response.type,\n      payload = response.payload;\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: type,\n    payload: payload\n  });\n};\n\nexports.uiResponse = uiResponse;\n\nvar renderWebUSBButton = function renderWebUSBButton(className) {\n  (0, _button[\"default\"])(className, _settings.webusbSrc, iframe.origin);\n};\n\nexports.renderWebUSBButton = renderWebUSBButton;\n\nvar getSettings = function getSettings() {\n  if (!iframe.instance) {\n    return Promise.resolve((0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_NotInitialized')));\n  }\n\n  return call({\n    method: 'getSettings'\n  });\n};\n\nexports.getSettings = getSettings;\n\nvar customMessage = /*#__PURE__*/function () {\n  var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(params) {\n    var callback, customMessageListener, response;\n    return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (iframe.instance) {\n              _context4.next = 2;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_NotInitialized');\n\n          case 2:\n            if (!(typeof params.callback !== 'function')) {\n              _context4.next = 4;\n              break;\n            }\n\n            return _context4.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_CustomMessage_Callback')));\n\n          case 4:\n            // TODO: set message listener only if iframe is loaded correctly\n            callback = params.callback;\n\n            customMessageListener = /*#__PURE__*/function () {\n              var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.CUSTOM_MESSAGE_REQUEST)) {\n                          _context3.next = 6;\n                          break;\n                        }\n\n                        _context3.next = 4;\n                        return callback(data.payload);\n\n                      case 4:\n                        payload = _context3.sent;\n\n                        if (payload) {\n                          customMessageResponse(payload);\n                        } else {\n                          customMessageResponse({\n                            message: 'release'\n                          });\n                        }\n\n                      case 6:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              }));\n\n              return function customMessageListener(_x4) {\n                return _ref4.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', customMessageListener, false);\n            _context4.next = 9;\n            return call(_objectSpread(_objectSpread({\n              method: 'customMessage'\n            }, params), {}, {\n              callback: null\n            }));\n\n          case 9:\n            response = _context4.sent;\n            window.removeEventListener('message', customMessageListener);\n            return _context4.abrupt(\"return\", response);\n\n          case 12:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function customMessage(_x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexports.customMessage = customMessage;\n\nvar requestLogin = /*#__PURE__*/function () {\n  var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(params) {\n    var callback, loginChallengeListener, response;\n    return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            if (iframe.instance) {\n              _context6.next = 2;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_NotInitialized');\n\n          case 2:\n            if (!(typeof params.callback === 'function')) {\n              _context6.next = 11;\n              break;\n            }\n\n            callback = params.callback; // TODO: set message listener only if iframe is loaded correctly\n\n            loginChallengeListener = /*#__PURE__*/function () {\n              var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n                  while (1) {\n                    switch (_context5.prev = _context5.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.LOGIN_CHALLENGE_REQUEST)) {\n                          _context5.next = 12;\n                          break;\n                        }\n\n                        _context5.prev = 2;\n                        _context5.next = 5;\n                        return callback();\n\n                      case 5:\n                        payload = _context5.sent;\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: payload\n                        });\n                        _context5.next = 12;\n                        break;\n\n                      case 9:\n                        _context5.prev = 9;\n                        _context5.t0 = _context5[\"catch\"](2);\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: _context5.t0.message\n                        });\n\n                      case 12:\n                      case \"end\":\n                        return _context5.stop();\n                    }\n                  }\n                }, _callee5, null, [[2, 9]]);\n              }));\n\n              return function loginChallengeListener(_x6) {\n                return _ref6.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', loginChallengeListener, false);\n            _context6.next = 8;\n            return call(_objectSpread(_objectSpread({\n              method: 'requestLogin'\n            }, params), {}, {\n              asyncChallenge: true,\n              callback: null\n            }));\n\n          case 8:\n            response = _context6.sent;\n            window.removeEventListener('message', loginChallengeListener);\n            return _context6.abrupt(\"return\", response);\n\n          case 11:\n            return _context6.abrupt(\"return\", call(_objectSpread({\n              method: 'requestLogin'\n            }, params)));\n\n          case 12:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n\n  return function requestLogin(_x5) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nexports.requestLogin = requestLogin;\n\nvar disableWebUSB = function disableWebUSB() {\n  if (!iframe.instance) {\n    throw _constants.ERRORS.TypedError('Init_NotInitialized');\n  }\n\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.TRANSPORT.DISABLE_WEBUSB\n  });\n};\n\nexports.disableWebUSB = disableWebUSB;","map":{"version":3,"names":["_interopRequireDefault","require","exports","__esModule","disableWebUSB","requestLogin","customMessage","getSettings","renderWebUSBButton","uiResponse","call","init","cancel","dispose","manifest","eventEmitter","_regenerator","_asyncToGenerator2","_defineProperty2","_events","_PopupManager","iframe","_interopRequireWildcard","_button","_message","_builder2","_ConnectSettings","_debug","_constants","$T","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","getOwnPropertyDescriptors","defineProperties","_log","initLog","_settings","parse","_popupManager","initPopupManager","pm","on","POPUP","CLOSED","error","postMessage","type","payload","data","removeAllListeners","close","emit","handleMessage","messageEvent","origin","message","parseMessage","event","id","log","RESPONSE_EVENT","messagePromises","resolve","success","warn","DEVICE_EVENT","TRANSPORT_EVENT","BLOCKCHAIN_EVENT","UI_EVENT","IFRAME","BOOTSTRAP","clearTimeout","LOADED","initPromise","ERROR","reject","_ref","mark","_callee","settings","wrap","_callee$","_context","prev","next","instance","ERRORS","TypedError","lazyLoad","abrupt","enabled","debug","window","addEventListener","stop","_x","_ref2","_callee2","params","response","_callee2$","_context2","timeout","errorMessage","request","t0","includes","code","UiMessage","UI","IFRAME_FAILURE","popup","CALL","sent","unlock","t1","_x2","customMessageResponse","CUSTOM_MESSAGE_RESPONSE","className","webusbSrc","Promise","method","_ref3","_callee4","callback","customMessageListener","_callee4$","_context4","_ref4","_callee3","_callee3$","_context3","CUSTOM_MESSAGE_REQUEST","_x4","removeEventListener","_x3","_ref5","_callee6","loginChallengeListener","_callee6$","_context6","_ref6","_callee5","_callee5$","_context5","LOGIN_CHALLENGE_REQUEST","LOGIN_CHALLENGE_RESPONSE","_x6","asyncChallenge","_x5","TRANSPORT","DISABLE_WEBUSB"],"sources":["/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/trezor-connect/lib/env/browser/index.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.disableWebUSB = exports.requestLogin = exports.customMessage = exports.getSettings = exports.renderWebUSBButton = exports.uiResponse = exports.call = exports.init = exports.cancel = exports.dispose = exports.manifest = exports.eventEmitter = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _events = _interopRequireDefault(require(\"events\"));\n\nvar _PopupManager = _interopRequireDefault(require(\"../../popup/PopupManager\"));\n\nvar iframe = _interopRequireWildcard(require(\"../../iframe/builder\"));\n\nvar _button = _interopRequireDefault(require(\"../../webusb/button\"));\n\nvar _message = require(\"../../message\");\n\nvar _builder2 = require(\"../../message/builder\");\n\nvar _ConnectSettings = require(\"../../data/ConnectSettings\");\n\nvar _debug = require(\"../../utils/debug\");\n\nvar _constants = require(\"../../constants\");\n\nvar $T = _interopRequireWildcard(require(\"../../types\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar eventEmitter = new _events[\"default\"]();\nexports.eventEmitter = eventEmitter;\n\nvar _log = (0, _debug.initLog)('[trezor-connect.js]');\n\nvar _settings = (0, _ConnectSettings.parse)();\n\nvar _popupManager;\n\nvar initPopupManager = function initPopupManager() {\n  var pm = new _PopupManager[\"default\"](_settings);\n  pm.on(_constants.POPUP.CLOSED, function (error) {\n    iframe.postMessage({\n      type: _constants.POPUP.CLOSED,\n      payload: error ? {\n        error: error\n      } : null\n    }, false);\n  });\n  return pm;\n};\n\nvar manifest = function manifest(data) {\n  _settings = (0, _ConnectSettings.parse)(_objectSpread(_objectSpread({}, _settings), {}, {\n    manifest: data\n  }));\n};\n\nexports.manifest = manifest;\n\nvar dispose = function dispose() {\n  eventEmitter.removeAllListeners();\n  iframe.dispose();\n  _settings = (0, _ConnectSettings.parse)();\n\n  if (_popupManager) {\n    _popupManager.close();\n  }\n};\n\nexports.dispose = dispose;\n\nvar cancel = function cancel(error) {\n  if (_popupManager) {\n    _popupManager.emit(_constants.POPUP.CLOSED, error);\n  }\n}; // handle message received from iframe\n\n\nexports.cancel = cancel;\n\nvar handleMessage = function handleMessage(messageEvent) {\n  // ignore messages from domain other then iframe origin\n  if (messageEvent.origin !== iframe.origin) return;\n  var message = (0, _message.parseMessage)(messageEvent.data);\n  var event = message.event,\n      type = message.type,\n      payload = message.payload;\n  var id = message.id || 0;\n\n  _log.log('handleMessage', message);\n\n  switch (event) {\n    case _constants.RESPONSE_EVENT:\n      if (iframe.messagePromises[id]) {\n        // resolve message promise (send result of call method)\n        iframe.messagePromises[id].resolve({\n          id: id,\n          success: message.success,\n          payload: payload\n        });\n        delete iframe.messagePromises[id];\n      } else {\n        _log.warn(\"Unknown message id \" + id);\n      }\n\n      break;\n\n    case _constants.DEVICE_EVENT:\n      // pass DEVICE event up to html\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload); // DEVICE_EVENT also emit single events (connect/disconnect...)\n\n      break;\n\n    case _constants.TRANSPORT_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.BLOCKCHAIN_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.UI_EVENT:\n      if (type === _constants.IFRAME.BOOTSTRAP) {\n        iframe.clearTimeout();\n        break;\n      }\n\n      if (type === _constants.IFRAME.LOADED) {\n        iframe.initPromise.resolve();\n      }\n\n      if (type === _constants.IFRAME.ERROR) {\n        iframe.initPromise.reject(payload.error);\n      } // pass UI event up\n\n\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    default:\n      _log.log('Undefined message', event, messageEvent);\n\n  }\n};\n\nvar init = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(settings) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (settings === void 0) {\n              settings = {};\n            }\n\n            if (!iframe.instance) {\n              _context.next = 3;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_AlreadyInitialized');\n\n          case 3:\n            _settings = (0, _ConnectSettings.parse)(_objectSpread(_objectSpread({}, _settings), settings));\n\n            if (_settings.manifest) {\n              _context.next = 6;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_ManifestMissing');\n\n          case 6:\n            if (!_settings.lazyLoad) {\n              _context.next = 9;\n              break;\n            }\n\n            // reset \"lazyLoad\" after first use\n            _settings.lazyLoad = false;\n            return _context.abrupt(\"return\");\n\n          case 9:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _log.enabled = !!_settings.debug;\n            window.addEventListener('message', handleMessage);\n            window.addEventListener('unload', dispose);\n            _context.next = 15;\n            return iframe.init(_settings);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function init(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.init = init;\n\nvar call = /*#__PURE__*/function () {\n  var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(params) {\n    var response;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(!iframe.instance && !iframe.timeout)) {\n              _context2.next = 15;\n              break;\n            }\n\n            // init popup with lazy loading before iframe initialization\n            _settings = (0, _ConnectSettings.parse)(_settings);\n\n            if (_settings.manifest) {\n              _context2.next = 4;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 4:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _popupManager.request(true); // auto init with default settings\n\n\n            _context2.prev = 6;\n            _context2.next = 9;\n            return init(_settings);\n\n          case 9:\n            _context2.next = 15;\n            break;\n\n          case 11:\n            _context2.prev = 11;\n            _context2.t0 = _context2[\"catch\"](6);\n\n            if (_popupManager) {\n              // Catch fatal iframe errors (not loading)\n              if (['Init_IframeBlocked', 'Init_IframeTimeout'].includes(_context2.t0.code)) {\n                _popupManager.postMessage((0, _builder2.UiMessage)(_constants.UI.IFRAME_FAILURE));\n              } else {\n                _popupManager.close();\n              }\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t0));\n\n          case 15:\n            if (!iframe.timeout) {\n              _context2.next = 17;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 17:\n            if (!iframe.error) {\n              _context2.next = 19;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(iframe.error));\n\n          case 19:\n            // request popup window it might be used in the future\n            if (_settings.popup && _popupManager) {\n              _popupManager.request();\n            } // post message to iframe\n\n\n            _context2.prev = 20;\n            _context2.next = 23;\n            return iframe.postMessage({\n              type: _constants.IFRAME.CALL,\n              payload: params\n            });\n\n          case 23:\n            response = _context2.sent;\n\n            if (!response) {\n              _context2.next = 27;\n              break;\n            }\n\n            if (!response.success && response.payload.code !== 'Device_CallInProgress' && _popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", response);\n\n          case 27:\n            if (_popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_NoResponse')));\n\n          case 31:\n            _context2.prev = 31;\n            _context2.t1 = _context2[\"catch\"](20);\n\n            _log.error('__call error', _context2.t1);\n\n            if (_popupManager) {\n              _popupManager.close();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t1));\n\n          case 36:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[6, 11], [20, 31]]);\n  }));\n\n  return function call(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.call = call;\n\nvar customMessageResponse = function customMessageResponse(payload) {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.UI.CUSTOM_MESSAGE_RESPONSE,\n    payload: payload\n  });\n};\n\nvar uiResponse = function uiResponse(response) {\n  if (!iframe.instance) {\n    throw _constants.ERRORS.TypedError('Init_NotInitialized');\n  }\n\n  var type = response.type,\n      payload = response.payload;\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: type,\n    payload: payload\n  });\n};\n\nexports.uiResponse = uiResponse;\n\nvar renderWebUSBButton = function renderWebUSBButton(className) {\n  (0, _button[\"default\"])(className, _settings.webusbSrc, iframe.origin);\n};\n\nexports.renderWebUSBButton = renderWebUSBButton;\n\nvar getSettings = function getSettings() {\n  if (!iframe.instance) {\n    return Promise.resolve((0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_NotInitialized')));\n  }\n\n  return call({\n    method: 'getSettings'\n  });\n};\n\nexports.getSettings = getSettings;\n\nvar customMessage = /*#__PURE__*/function () {\n  var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(params) {\n    var callback, customMessageListener, response;\n    return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (iframe.instance) {\n              _context4.next = 2;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_NotInitialized');\n\n          case 2:\n            if (!(typeof params.callback !== 'function')) {\n              _context4.next = 4;\n              break;\n            }\n\n            return _context4.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_CustomMessage_Callback')));\n\n          case 4:\n            // TODO: set message listener only if iframe is loaded correctly\n            callback = params.callback;\n\n            customMessageListener = /*#__PURE__*/function () {\n              var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.CUSTOM_MESSAGE_REQUEST)) {\n                          _context3.next = 6;\n                          break;\n                        }\n\n                        _context3.next = 4;\n                        return callback(data.payload);\n\n                      case 4:\n                        payload = _context3.sent;\n\n                        if (payload) {\n                          customMessageResponse(payload);\n                        } else {\n                          customMessageResponse({\n                            message: 'release'\n                          });\n                        }\n\n                      case 6:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              }));\n\n              return function customMessageListener(_x4) {\n                return _ref4.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', customMessageListener, false);\n            _context4.next = 9;\n            return call(_objectSpread(_objectSpread({\n              method: 'customMessage'\n            }, params), {}, {\n              callback: null\n            }));\n\n          case 9:\n            response = _context4.sent;\n            window.removeEventListener('message', customMessageListener);\n            return _context4.abrupt(\"return\", response);\n\n          case 12:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function customMessage(_x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexports.customMessage = customMessage;\n\nvar requestLogin = /*#__PURE__*/function () {\n  var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(params) {\n    var callback, loginChallengeListener, response;\n    return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            if (iframe.instance) {\n              _context6.next = 2;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_NotInitialized');\n\n          case 2:\n            if (!(typeof params.callback === 'function')) {\n              _context6.next = 11;\n              break;\n            }\n\n            callback = params.callback; // TODO: set message listener only if iframe is loaded correctly\n\n            loginChallengeListener = /*#__PURE__*/function () {\n              var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n                  while (1) {\n                    switch (_context5.prev = _context5.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.LOGIN_CHALLENGE_REQUEST)) {\n                          _context5.next = 12;\n                          break;\n                        }\n\n                        _context5.prev = 2;\n                        _context5.next = 5;\n                        return callback();\n\n                      case 5:\n                        payload = _context5.sent;\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: payload\n                        });\n                        _context5.next = 12;\n                        break;\n\n                      case 9:\n                        _context5.prev = 9;\n                        _context5.t0 = _context5[\"catch\"](2);\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: _context5.t0.message\n                        });\n\n                      case 12:\n                      case \"end\":\n                        return _context5.stop();\n                    }\n                  }\n                }, _callee5, null, [[2, 9]]);\n              }));\n\n              return function loginChallengeListener(_x6) {\n                return _ref6.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', loginChallengeListener, false);\n            _context6.next = 8;\n            return call(_objectSpread(_objectSpread({\n              method: 'requestLogin'\n            }, params), {}, {\n              asyncChallenge: true,\n              callback: null\n            }));\n\n          case 8:\n            response = _context6.sent;\n            window.removeEventListener('message', loginChallengeListener);\n            return _context6.abrupt(\"return\", response);\n\n          case 11:\n            return _context6.abrupt(\"return\", call(_objectSpread({\n              method: 'requestLogin'\n            }, params)));\n\n          case 12:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n\n  return function requestLogin(_x5) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nexports.requestLogin = requestLogin;\n\nvar disableWebUSB = function disableWebUSB() {\n  if (!iframe.instance) {\n    throw _constants.ERRORS.TypedError('Init_NotInitialized');\n  }\n\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.TRANSPORT.DISABLE_WEBUSB\n  });\n};\n\nexports.disableWebUSB = disableWebUSB;"],"mappings":"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"},"metadata":{},"sourceType":"script"}